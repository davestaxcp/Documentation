<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Exchange Integration | Counterparty</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://counterpartyxcp.github.io/Documentation/docs/advanced/exchange-integration/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Exchange Integration | Counterparty"><meta data-react-helmet="true" name="description" content="By adding support for Counterparty, your exchange not only gets XCP market support, but support for any other Counterparty asset such as Bitcrystals) or FoldingCoin."><meta data-react-helmet="true" property="og:description" content="By adding support for Counterparty, your exchange not only gets XCP market support, but support for any other Counterparty asset such as Bitcrystals) or FoldingCoin."><link data-react-helmet="true" rel="icon" href="/Documentation/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://counterpartyxcp.github.io/Documentation/docs/advanced/exchange-integration/"><link data-react-helmet="true" rel="alternate" href="https://counterpartyxcp.github.io/Documentation/docs/advanced/exchange-integration/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://counterpartyxcp.github.io/Documentation/docs/advanced/exchange-integration/" hreflang="x-default"><link rel="stylesheet" href="/Documentation/assets/css/styles.2814d311.css">
<link rel="preload" href="/Documentation/assets/js/runtime~main.5f179a1d.js" as="script">
<link rel="preload" href="/Documentation/assets/js/main.ea74c636.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Documentation/"><div class="navbar__logo"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Counterparty</b></a><a class="navbar__item navbar__link" href="/Documentation/docs/basics/what-is-counterparty/a-bitcoin-protocol/">Basics</a><a class="navbar__item navbar__link" href="/Documentation/docs/wallets/counterwallet/">Wallets</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Documentation/docs/advanced/architecture/">Advanced</a><a class="navbar__item navbar__link" href="/Documentation/docs/develop/api/overview/">Develop</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/architecture/">Platform Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/protocol/">Protocol Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/cli/">Command-line (CLI) Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/Documentation/docs/advanced/advanced-usage/sending-bulk/">Advanced Usage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/Documentation/docs/advanced/federated-node/getting-started/">Federated Node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/Documentation/docs/advanced/installation/bitcoin-core/">Installation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Documentation/docs/advanced/exchange-integration/">Exchange Integration</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Exchange Integration</h1></header><p>By adding support for Counterparty, your exchange not only gets <a href="http://coinmarketcap.com/currencies/counterparty/" target="_blank" rel="noopener noreferrer">XCP market</a> support, but support for any other Counterparty asset such as <a href="http://coinmarketcap.com/assets/bitcrystals/" target="_blank" rel="noopener noreferrer">Bitcrystals</a>) or <a href="https://coinmarketcap.com/currencies/foldingcoin/" target="_blank" rel="noopener noreferrer">FoldingCoin</a>.</p><p>Technically, the process is rather straightforward. However, as Counterparty is not a fork of Bitcoin Core, adding Counterparty support to your exchange is slightly different from adding support for a cryptocurrency that is, like Litecoin or Dogecoin.  We outline the general process below (for XCP, but the process is identical for all Counterparty assets):</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="basic-setup">Basic Setup<a class="hash-link" href="#basic-setup" title="Direct link to heading">â€‹</a></h2><ul><li><p>Follow the instructions <a href="http://counterparty.io/docs/federated_node/" target="_blank" rel="noopener noreferrer">here</a> to set up a full node. You can install the <code>base</code> configuration (e.g. <code>fednode install base master</code>)</p></li><li><p>Alternatively, you can install and configure manually. Those instructions are <a href="https://github.com/CounterpartyXCP/counterparty-lib/blob/develop/README.md#manual-installation" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Once the system is set up, get started working with <code>counterparty-server</code>&#x27;s <a href="/Documentation/docs/develop/api/">API</a>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="handling-deposits-using-separate-addresses">Handling Deposits using Separate Addresses<a class="hash-link" href="#handling-deposits-using-separate-addresses" title="Direct link to heading">â€‹</a></h2><ul><li><p>Create a XCP holding address (or several primary XCP holding addresses). The address will hold deposited XCP funds for all users using the exchange.</p></li><li><p>Create a regular Bitcoin address for each user wanting to deposit XCP using the API of the Bitcoin Core instance that <code>counterparty-server</code> is connecting to.</p></li><li><p>Poll for deposits using <code>get_sends</code> <a href="/Documentation/docs/develop/api/">API method</a>, filtering for <code>asset==XCP</code>, <code>destination==deposit_address</code> and <code>block_index&lt;=current_block_index-number_of_desired_confirmations</code>. Record the quantity of the send transaction and the transaction&#x27;s <code>txid</code>.</p></li><li><p>&#x27;Prime&#x27; the deposit address by sending it 0.0005 BTC.</p></li><li><p>For deposit, send the quantity deposited to the holding address using the <code>do_send</code> <a href="/Documentation/docs/develop/api/">API method</a> with the flag <code>unconfirmed=True</code> (so you don&#x27;t have to wait for the priming to confirm). Record the <code>txid</code> of this transaction.</p></li><li><p>When the second send is confirmed (poll <code>get_sends</code> again), credit the userâ€™s account balance.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="handling-deposits-using-memo-transactions">Handling Deposits using Memo Transactions<a class="hash-link" href="#handling-deposits-using-memo-transactions" title="Direct link to heading">â€‹</a></h2><ul><li><p>Create a XCP deposit address. The address will hold deposited XCP funds for all users using the exchange.</p></li><li><p>&#x27;Prime&#x27; the deposit address by sending it 0.001 BTC.</p></li><li><p>Make the deposit address require a memo by <a href="/Documentation/docs/develop/api/#create_broadcast">broadcasting</a> <code>OPTIONS 1</code> from that address.  The value and fee_fraction can be 0.</p></li><li><p>When a user wishes to deposit to your exchange, generate a unique hexadecimal invoice ID for the deposit and convey that to the user.  The user must send counterparty assets into the address along with the matching invoice ID in the memo field.  If the user fails to include a memo, the send will be rejected by the network and the user&#x27;s address will retain the assets they sent.</p></li><li><p>Poll for deposits using <code>get_sends</code> <a href="/Documentation/docs/develop/api/">API method</a>, filtering for <code>asset==XCP</code>, <code>destination==deposit_address</code> and <code>block_index&lt;={current_block_index-number_of_desired_confirmations}</code> and <code>memo_hex=={invoice_id}</code>. Record the quantity of the send transaction and the transaction&#x27;s <code>txid</code>.</p></li><li><p>When the send is confirmed with 2 confirmations (poll <code>get_sends</code> again), credit the userâ€™s account balance.</p></li><li><p>Memo transactions are available as of block 489956</p></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="handling-withdrawals-single-send">Handling Withdrawals (Single Send)<a class="hash-link" href="#handling-withdrawals-single-send" title="Direct link to heading">â€‹</a></h2><ul><li><p>Prime the holding address if its current balance is below 0.0005 BTC.</p></li><li><p>Send the funds to the user-provided address with <code>create_send</code> (Counterparty API).</p></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="batching-withdrawals-multi-peer-multi-asset-send">Batching Withdrawals (Multi-Peer-Multi-Asset Send)<a class="hash-link" href="#batching-withdrawals-multi-peer-multi-asset-send" title="Direct link to heading">â€‹</a></h2><ul><li><p>Prime the holding address if its current balance is below 0.0005 BTC.</p></li><li><p>Generate first MPMA transaction by making a <code>create_send</code> (Counterparty API) call and specify as many assets and recipient addresses as you would like.</p></li><li><p>Sign and Broadcast first MPMA transaction and note <code>txid</code></p></li><li><p>Generate second MPMA transaction by making identical <code>create_send</code> (Counterparty API) call as before, except also specify <code>p2sh_pretx_txid</code> param and give <code>txid</code> of first MPMA transaction</p></li><li><p>Sign and Broadcast second MPMA transaction</p></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="best-practices">Best practices<a class="hash-link" href="#best-practices" title="Direct link to heading">â€‹</a></h2><ul><li><p>For deposits, wait for at least two confirmations on the send to the desposit address and one confirmation for the send to the holding address.</p></li><li><p>Keep the private key for the holding address secret and safe.</p></li><li><p>Keep the bulk of your exchange&#x27;s funds in cold storage.</p></li><li><p>Set a maximum XCP and BTC withdrawal amount, both per day and per event.</p></li><li><p>Use a segwit address for memo deposits and MPMA/Batched withdrawals to keep transaction costs minimal.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/advanced/exchange-integration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Documentation/docs/advanced/installation/windows/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Counterparty Dependencies on Windows</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-setup" class="table-of-contents__link toc-highlight">Basic Setup</a></li><li><a href="#handling-deposits-using-separate-addresses" class="table-of-contents__link toc-highlight">Handling Deposits using Separate Addresses</a></li><li><a href="#handling-deposits-using-memo-transactions" class="table-of-contents__link toc-highlight">Handling Deposits using Memo Transactions</a></li><li><a href="#handling-withdrawals-single-send" class="table-of-contents__link toc-highlight">Handling Withdrawals (Single Send)</a></li><li><a href="#batching-withdrawals-multi-peer-multi-asset-send" class="table-of-contents__link toc-highlight">Batching Withdrawals (Multi-Peer-Multi-Asset Send)</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Documentation/docs/basics/what-is-counterparty/a-bitcoin-protocol/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/wsjKtPGrMF" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://counterpartytalk.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.reddit.com/r/counterparty_xcp/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/Counterparty_XCP" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/CounterpartyXCP" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/Documentation/docs/advanced/exchange-integration/docs/foundation-bylaws/bylaws/">Bylaws</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">CC Â© 2014 - 2022 Counterparty, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Documentation/assets/js/runtime~main.5f179a1d.js"></script>
<script src="/Documentation/assets/js/main.ea74c636.js"></script>
</body>
</html>